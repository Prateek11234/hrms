HRMS LITE - DEPLOYMENT GUIDE
============================

This document explains, step by step, how to deploy **this exact HRMS Lite project**:

- Backend (FastAPI) on:
  - Render (recommended example)
  - Railway (alternative example)
- Frontend (React/Vite) on:
  - Vercel (recommended example)
  - Netlify (alternative example)

It assumes:
- The project structure is exactly as in this repository:
  - `backend/` for FastAPI
  - `frontend/` for React
- You have already pushed the code to **GitHub** (or a similar Git provider).


0. PREP WORK (GITHUB & ENV CHECKS)
----------------------------------

0.1. Initialize git and push to GitHub
--------------------------------------

From the project root (`hrms lite/`):

1. Initialize git (if not already):
   - `git init`

2. Add all files:
   - `git add .`

3. Commit:
   - `git commit -m "Initial HRMS Lite implementation"`

4. Create a new empty repository on GitHub (e.g., `hrms-lite`).

5. Add the remote:
   - `git remote add origin https://github.com/<your-username>/hrms-lite.git`

6. Push:
   - `git push -u origin main`  
     (or `master`, depending on your default branch setup).


0.2. Confirm environment files in repo
--------------------------------------

Make sure:
- `backend/.env.example` exists (it is safe to commit; it has sample values only).
- `frontend/.env.example` exists.

Make sure:
- **Do not** commit `.env` or `*.db` files; `.gitignore` already prevents that.

These example files will help you configure environment variables on hosting platforms.


1. BACKEND DEPLOYMENT (FASTAPI API)
-----------------------------------

We’ll describe two common hosting options:
- **Render (recommended)** – easy “Web Service” with Docker support.
- **Railway** – similar to Render; also supports Docker and plain commands.

You only need **one** backend deployment (pick either Render or Railway).


1.A. Deploy backend on Render (Docker)
--------------------------------------

High-level idea:
- Render builds and runs a Docker image using `backend/Dockerfile`.
- The FastAPI app runs via `uvicorn` on the port Render provides.
- You point the frontend to Render’s URL via `VITE_API_BASE_URL`.

Step-by-step:

1. Go to `https://render.com` and log in or sign up.

2. Connect your GitHub account if you haven’t already.

3. Click **“New +”** → **“Web Service”**.

4. Choose your GitHub repo:
   - Select the repository where this HRMS Lite project lives.

5. Basic service settings:
   - **Name**: e.g., `hrms-lite-api`.
   - **Region**: choose a region close to your users.

6. Environment:
   - Select **“Docker”** as the runtime environment.

7. Root directory / Docker context:
   - Render will use the repo root by default.
   - Because `backend/Dockerfile` is inside `backend/`, specify:
     - **Root Directory** (or equivalent) = `backend`  
       (this tells Render to treat `backend/` as the app root where the `Dockerfile` lives).

8. Dockerfile:
   - Render will auto-detect `backend/Dockerfile`.
   - You don’t need to change the command; `CMD` is already defined in the Dockerfile as:
     - `uvicorn app.main:app --host 0.0.0.0 --port ${PORT:-8000}`

9. Environment variables (very important):
   - Add the following:
     - `DATABASE_URL` (optional, can leave default):
       - Default in Dockerfile is `sqlite:////app/hrms.db`.  
         This is fine for a small demo; for production, you’d point this to a managed DB.
     - `CORS_ORIGINS`:
       - Temporarily, you can set this to:
         - `http://localhost:5173` (for local frontend testing) **OR**
         - The final frontend URL (once you know it).
       - When you later deploy the frontend (e.g., `https://hrms-lite-frontend.vercel.app`), update this to that URL (or a comma-separated list if you want both local and prod).

10. Create the service:
    - Render will:
      - Clone the repo.
      - Build Docker image using `backend/Dockerfile`.
      - Install dependencies via `pip install -r requirements.txt`.
      - Run `uvicorn` with the appropriate port.

11. Wait for successful deploy:
    - Check Render deploy logs.
    - A successful run ends with lines showing uvicorn listening on `0.0.0.0:<PORT>`.

12. Confirm the API is up:
    - Render gives you a URL like:  
      `https://hrms-lite-api.onrender.com`
    - Visit in browser:
      - `https://hrms-lite-api.onrender.com/health` → should return `{"ok": true}`.
      - `https://hrms-lite-api.onrender.com/docs` → Swagger UI for all endpoints.

Keep this URL; you’ll use it as `VITE_API_BASE_URL` for the frontend.


1.B. Deploy backend on Railway (Docker)
--------------------------------------

Steps (conceptually same as Render; exact UI labels may differ slightly):

1. Go to `https://railway.app` and log in / sign up.

2. Click **“New Project”** → **“Deploy from GitHub repo”**.

3. Select your HRMS Lite repository.

4. Railway will detect Docker if configured:
   - Ensure that the **service** is configured to use the Dockerfile in `backend/`.
   - Set the **project path** or **build context** to `backend`.

5. Environment variables:
   - Add:
     - `DATABASE_URL` (optional, default to SQLite as in Dockerfile).
     - `CORS_ORIGINS` = your frontend URL (or `http://localhost:5173` for testing).

6. Port:
   - Railway typically passes a `PORT` env variable to the container.
   - The Dockerfile already uses `${PORT:-8000}`, so you don’t need to change the command.

7. Deploy:
   - Wait for build & deploy to succeed.
   - Check the logs to confirm uvicorn is running.

8. Confirm API:
   - Railway gives an URL like:
     - `https://hrms-lite-api.up.railway.app`
   - Visit `/health` and `/docs` to test.

Again, keep this API URL for the frontend config.


2. FRONTEND DEPLOYMENT (REACT/VITE)
-----------------------------------

We’ll describe two options:
- **Vercel (recommended)** – especially friendly for Vite + React.
- **Netlify** – also straightforward for static SPAs.

You only need **one** frontend deployment (pick either Vercel or Netlify).


2.A. Deploy frontend on Vercel
------------------------------

High-level idea:
- Vercel builds the `frontend/` directory using `npm run build`.
- Output from `dist/` is served as static assets.
- The included `vercel.json` ensures all routes serve `index.html` (for React Router).

Step-by-step:

1. Go to `https://vercel.com` and log in / sign up.

2. Click **“New Project”**.

3. Import your GitHub repo:
   - Select the HRMS Lite repository.

4. Project configuration:
   - **Framework Preset**: Vercel often auto-detects Vite; if not, you can choose **Vite** or just **Other**.
   - Crucially, set **“Root Directory”** to `frontend`:
     - Click “Edit” or “More Settings” at import time.
     - Choose `frontend/` as the project root (so Vercel uses the frontend).

5. Build settings:
   - **Build Command**: `npm run build`
   - **Output Directory**: `dist`
   - Vercel usually auto-detects these for Vite.

6. Environment variables:
   - In the “Environment Variables” section, add:
     - `VITE_API_BASE_URL`:
       - Set this to the deployed backend URL from Render/Railway, for example:
         - `https://hrms-lite-api.onrender.com`
       - Make sure there is **no trailing slash**.
   - Optionally, for local preview deployments (“Preview” env), you can set different values, but the important one is “Production”.

7. SPA routing (via `vercel.json`):
   - The `frontend/vercel.json` file in the repo is:
     - `{ "rewrites": [ { "source": "/(.*)", "destination": "/index.html" } ] }`
   - This ensures that direct navigation to routes like `/employees` still returns `index.html`, allowing React Router to handle the route.
   - Vercel automatically reads this config at build time.

8. Deploy:
   - Click **“Deploy”**.
   - Vercel will:
     - Install dependencies (`npm install`).
     - Build the app (`npm run build`).
     - Serve files from `dist/`.

9. Verify:
   - After deployment, Vercel gives you a URL:
     - e.g., `https://hrms-lite-frontend.vercel.app`
   - Visit the URL:
     - On page load, the app should show the **Dashboard**.
     - The API line in UI should show `VITE_API_BASE_URL` (the backend URL).
   - Test cross-origin functionality:
     - Add employees, navigate to Employees and Attendance pages.
     - If CORS is misconfigured, you’ll see errors; in that case:
       - Go back to the backend (Render/Railway) and update `CORS_ORIGINS` to include this Vercel URL.
       - Redeploy backend if needed.


2.B. Deploy frontend on Netlify
-------------------------------

High-level idea:
- Netlify builds `frontend/` using `npm run build`.
- Serves contents of `dist/` as static files.
- `_redirects` in `public/` handles SPA routing.

Step-by-step:

1. Go to `https://www.netlify.com` and log in / sign up.

2. Click **“Add new site”** → **“Import an existing project”**.

3. Choose your Git provider and select the HRMS Lite repository.

4. Configure basic build settings:
   - **Base directory**: `frontend`
     - This tells Netlify to run builds from the `frontend/` folder.
   - **Build command**: `npm run build`
   - **Publish directory**: `dist`

5. Environment variables:
   - In the “Environment variables” section, add:
     - `VITE_API_BASE_URL` = your backend URL (e.g., `https://hrms-lite-api.onrender.com`).

6. SPA routing file:
   - The project contains `frontend/public/_redirects` with:
     - `/*    /index.html   200`
   - Netlify copies `public/_redirects` into the build output, which:
     - Redirects all paths to `index.html` while returning status code 200.
     - Necessary so that React Router can handle client-side routes.

7. Deploy:
   - Click **“Deploy site”**.
   - Netlify builds and serves the app.

8. Verify:
   - Netlify provides a URL like `https://hrms-lite-frontend.netlify.app`.
   - Visit the site:
     - Test navigation to `/employees` and `/employees/<id>` directly (e.g., via URL bar).
     - Test actions to confirm API connectivity.
   - If CORS errors occur:
     - Update backend `CORS_ORIGINS` to include the Netlify URL.
     - Redeploy the backend.


3. CONNECTING FRONTEND AND BACKEND CORRECTLY
-------------------------------------------

3.1. Set VITE_API_BASE_URL correctly
------------------------------------

On whichever frontend host you use (Vercel or Netlify), ensure:
- `VITE_API_BASE_URL` exactly matches the backend URL.

Examples:
- If backend is on Render:
  - `https://hrms-lite-api.onrender.com`
- If backend is on Railway:
  - `https://hrms-lite-api.up.railway.app`

No trailing slash, e.g.:
- GOOD: `https://hrms-lite-api.onrender.com`
- BAD: `https://hrms-lite-api.onrender.com/`

The frontend constructs URLs like:
- `VITE_API_BASE_URL + "/employees"` → `https://hrms-lite-api.onrender.com/employees`


3.2. Configure CORS_ORIGINS on backend
--------------------------------------

On the backend host (Render/Railway), set:

- `CORS_ORIGINS` to the frontend URL (or multiple origins separated by commas).

Examples:
- For Vercel:
  - `CORS_ORIGINS=https://hrms-lite-frontend.vercel.app`
- For Netlify:
  - `CORS_ORIGINS=https://hrms-lite-frontend.netlify.app`
- For both plus local dev:
  - `CORS_ORIGINS=http://localhost:5173,https://hrms-lite-frontend.vercel.app`

The backend uses this env variable to configure FastAPI’s CORS middleware:
- `allow_origins=_parse_cors_origins()`

If this is misconfigured:
- Browser requests will fail with CORS errors.
- Network tab in dev tools will show blocked requests.
- Fix by updating the env variable and redeploying the backend.


4. END-TO-END VERIFICATION AFTER DEPLOYMENT
------------------------------------------

After both backend and frontend are deployed:

1. Visit backend `/health`:
   - Ensure it returns `{"ok": true}`.

2. Visit backend `/docs`:
   - Quickly try:
     - `POST /employees` with sample data.
     - `GET /employees`.
     - `POST /employees/{employee_id}/attendance`.
     - `GET /employees/{employee_id}/attendance`.
   - Make sure responses look correct.

3. Visit frontend URL:
   - Check that the API URL shown in the UI matches your deployed backend.
   - Try the full flow:
     - Add an employee.
     - Navigate to Employees list, then to that employee’s attendance page.
     - Mark attendance (Present / Absent) for a given date.
     - Use filters on the attendance page.
     - Check the Dashboard page summary.

4. Test direct deep links:
   - Manually enter URLs like:
     - `/employees`
     - `/employees/EMP-001`
   - Confirm that the page loads (SPA routing config is correct).

5. Fix any issues:
   - If something fails:
     - Check browser dev tools for error messages.
     - Check backend host logs (Render/Railway).
     - Check environment variables on both hosts.


5. QUICK REFERENCE: HOST-SPECIFIC SETTINGS
------------------------------------------

Backend on Render:
- Root Directory: `backend`
- Runtime: Docker
- Env:
  - `CORS_ORIGINS` = frontend URL(s)
  - `DATABASE_URL` (optional, or keep default SQLite)

Backend on Railway:
- Service path: `backend` (Docker context)
- Env:
  - `CORS_ORIGINS` = frontend URL(s)
  - `DATABASE_URL` (optional)

Frontend on Vercel:
- Root Directory: `frontend`
- Build Command: `npm run build`
- Output Directory: `dist`
- Env:
  - `VITE_API_BASE_URL` = backend URL

Frontend on Netlify:
- Base Directory: `frontend`
- Build Command: `npm run build`
- Publish Directory: `dist`
- Env:
  - `VITE_API_BASE_URL` = backend URL


6. WHAT TO SUBMIT FOR THE ASSIGNMENT
------------------------------------

Once everything is deployed, you should submit:

- **Live Application URL**:
  - The frontend URL (e.g., Vercel or Netlify).

- **Hosted Backend API URL**:
  - The backend URL (Render or Railway).

- **GitHub Repository Link**:
  - Where the examiners can view source code (`backend/` + `frontend/`).

Make sure:
- The app functions without errors from those links.
- `README.md` and this `deployment.txt` are present to help reviewers understand the setup and deployment.

